
#------------------------------------------------
# sum.ys
# Name:徐文博
# 学号:1320240207
# 链表元素求和
#------------------------------------------------

    .pos 0
    irmovq stack, %rsp     # 初始化栈指针
    irmovq ele1, %rdi      # 传入第一个参数，链表头第一个元素地址
    call sum_list          # 调用sum_list函数
    halt                   # 程序结束

#------------------------------------------------
# long sum_list(list_ptr ls)
# %rdi = ls
# 返回指针在%rax中
#------------------------------------------------
sum_list:
    xorq %rax, %rax        #作为返回结果

Loop:
    andq %rdi, %rdi      # 判断参数ls是否为NULL
    je Done               # 如果是NULL，跳转到Done
    mrmovq 0(%rdi), %r10  # 取出当前节点的8字节值并放入r10
    addq %r10, %rax       # 将当前节点的值加到返回值中
    mrmovq 8(%rdi), %rdi  # 取出下一个节点的地址放入rdi中
    jmp Loop              # 继续循环
Done:
    ret


#------------------------------------------------
# 链表元素示例
#------------------------------------------------
    .align 8
ele1:
    .quad 0x00a     # long的大小为8字节（.quad），0x00a是当前节点的值
    .quad ele2       # 下一个节点的地址
ele2:
    .quad 0x0b0
    .quad ele3
ele3:
    .quad 0xc00
    .quad 0


#------------------------------------------------
# 栈空间
#------------------------------------------------
    .pos 0x200
stack:

